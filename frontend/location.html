<!DOCTYPE html>
<html>
<head>
    <title>Select Location</title>
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
<div class="location-overlay">
    <div class="location-box">
        <h2>Select Your Location</h2>

        <input type="text"
               id="locationInput"
               placeholder="Enter area or city"
               autocomplete="off">

        <!-- Suggestions -->
        <div id="suggestions" class="suggestions-box"></div>

        <button onclick="saveLocation()">Continue</button>
    </div>
</div>

<script src="js/location.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function () {

    const input = document.getElementById("locationInput");
    const suggestionsBox = document.getElementById("suggestions");

    let debounceTimer;

    input.addEventListener("input", function () {

        clearTimeout(debounceTimer);

        const query = input.value.trim();

        if (query.length < 3) {
            suggestionsBox.innerHTML = "";
            return;
        }

        debounceTimer = setTimeout(() => {
            fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${query}`)
                .then(response => response.json())
                .then(data => {

                    suggestionsBox.innerHTML = "";

                    if (data.length === 0) {
                        suggestionsBox.innerHTML =
                            "<div class='suggestion-item'>No results found</div>";
                        return;
                    }

                    data.forEach(place => {
                        const div = document.createElement("div");
                        div.classList.add("suggestion-item");
                        div.innerText = place.display_name;

                        div.onclick = function () {
                            input.value = place.display_name;
                            suggestionsBox.innerHTML = "";
                        };

                        suggestionsBox.appendChild(div);
                    });

                })
                .catch(error => {
                    console.error("Error fetching locations:", error);
                });
        }, 400);

    });

    function saveLocation() {

        const locationValue = input.value.trim();

        if (locationValue === "") {
            alert("Please enter location");
            return;
        }

        localStorage.setItem("location", locationValue);
        window.location.href = "products.html";
    }

    // Make saveLocation global (important for button onclick)
    window.saveLocation = saveLocation;

    document.addEventListener("click", function (e) {
        if (!e.target.closest(".location-box")) {
            suggestionsBox.innerHTML = "";
        }
    });

});
</script>
</body>
</html>